<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FDU Booking Console</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div class="bg"></div>
    <main class="layout">
      <header class="topbar">
        <div>
          <h1>FDU Booking Console</h1>
          <p class="muted">场馆可约时段总览、按场馆名预约、订单管理与定时任务</p>
        </div>
        <div class="livebox">
          <span id="liveDot" class="dot"></span>
          <span id="liveText">Offline</span>
        </div>
      </header>

      <section class="card conn-card">
        <h2>连接与账号</h2>
        <div class="grid cols-4">
          <label>
            API Base
            <input id="apiBase" type="text" placeholder="https://your-backend.example.com" />
          </label>
          <label>
            Access Token
            <input id="accessToken" type="password" placeholder="可选" />
          </label>
          <label>
            用户名
            <input id="username" type="text" placeholder="2430..." />
          </label>
          <label>
            密码
            <input id="password" type="password" placeholder="******" />
          </label>
        </div>
        <div class="row">
          <button id="saveConnBtn" class="btn primary">保存配置</button>
          <button id="healthBtn" class="btn">测试连接</button>
          <label class="inline"><input id="autoRefresh" type="checkbox" checked />自动刷新</label>
          <label class="inline">刷新周期(ms)
            <select id="refreshMs">
              <option value="3000">3000</option>
              <option value="5000" selected>5000</option>
              <option value="10000">10000</option>
            </select>
          </label>
          <label class="inline"><input id="useParallel" type="checkbox" checked />并行抓取可用时段</label>
          <label class="inline">并行数
            <select id="maxWorkers">
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </label>
        </div>
        <p id="connHint" class="hint warn">先填写可公网访问的后端 API Base（需支持 /api/*）。GitHub Pages 页面中 API Base 必须是 HTTPS。</p>
      </section>

      <section class="card">
        <h2>场馆可用时段总览</h2>
        <div class="row">
          <label>
            目标日期
            <input id="targetDate" type="text" value="tomorrow" placeholder="tomorrow 或 YYYY-MM-DD" />
          </label>
          <button id="refreshAvailabilityBtn" class="btn primary">刷新总览</button>
          <span id="availabilityMeta" class="muted"></span>
        </div>
        <div id="availabilityWrap" class="table-wrap big"></div>
      </section>

      <section class="card">
        <h2>立即预约（按场馆名）</h2>
        <div class="grid cols-4">
          <label>
            场馆名
            <select id="venueSelect"></select>
          </label>
          <label>
            可选时段
            <select id="slotSelect"></select>
          </label>
          <label>
            验证码重试
            <input id="captchaRetries" type="number" value="5" min="1" max="10" />
          </label>
          <div class="align-end">
            <button id="bookBtn" class="btn primary">立即预约</button>
          </div>
        </div>
        <pre id="bookResult" class="console"></pre>
      </section>

      <section class="card">
        <h2>定时任务</h2>
        <div class="grid cols-4">
          <label>
            执行时间
            <input id="runAt" type="datetime-local" />
          </label>
          <label>
            场馆名(核验)
            <input id="venueName" type="text" value="杨詠曼楼琴房" />
          </label>
          <label>
            指定时段号(0=任意)
            <input id="slotIndex" type="number" value="0" min="0" />
          </label>
          <div class="align-end">
            <button id="scheduleBtn" class="btn">创建定时任务</button>
          </div>
        </div>
        <div id="jobsWrap" class="table-wrap"></div>
      </section>

      <section class="card">
        <h2>我的订单（含撤销）</h2>
        <div class="row">
          <button id="refreshOrdersBtn" class="btn">刷新订单</button>
        </div>
        <div id="ordersWrap" class="table-wrap"></div>
      </section>
    </main>
    <script src="./app.js"></script>
  </body>
</html>
